{"version":3,"sources":["Models/MapType.enum.tsx","database.tsx","firebase-config.tsx","assets/courierIcon.png","assets/packageIcon.png","constants.tsx","websocket.tsx","Map.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["MapType","app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","uuid","database","getDatabase","API_ENDPOINT","ws","WebSocket","courierMarker","L","icon","iconUrl","courierIcon","iconRetinaUrl","iconSize","iconAnchor","popupAnchor","shadowUrl","shadowSize","shadowAnchor","className","packageIconMarker","packageIcon","transformWaypoints","positions","waypoints","forEach","p","push","latitude","longitude","Map","props","state","map","getMap","center","this","length","MapContainer","zoom","zoomControl","id","wp","index","Marker","position","Math","random","PackageRoute","type","ZoomControl","children","prevProps","equal","setState","Component","prevRoute","useMap","route","Routing","control","serviceUrl","lineOptions","styles","color","opacity","weight","createMarker","fitSelectedRoutes","courier","package","showAlternatives","removeControl","addControl","navigation","fitBounds","MapParentContainer","useState","courierWaypoints","setCourierWaypoints","packageWaypoints","setPackageWaypoints","packageCourierId","setPackageCourierId","wasHandshake","setWasHandshake","readyState","OPEN","send","JSON","stringify","useEffect","getWaypointsForCourier","getWaypointsForPackage","a","isLocal","get","ref","val","startPosition","currentPackages","currentPackage","Promise","all","undeliveredPackages","request","method","headers","token","fetch","then","response","json","data","packageRoute","courierId","packageModel","couriers","Object","keys","curId","employeeNumber","courierRef","onChildChanged","onmessage","message","parse","TileLayer","url","App","handleEvent","isLocalDev","URL","window","location","href","searchParams","console","log","onopen","onerror","e","str","addEventListener","event","flutter_inappwebview","callHandler","style","width","height","fontSize","fontWeight","React","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8b17cb16.chunk.js","sourcesContent":["export enum MapType {\r\n    package = 'package',\r\n    courier = 'courier',\r\n    navigation = 'navigation'\r\n}","import { initializeApp } from 'firebase/app';\r\nimport \"firebase/database\";\r\nimport { getDatabase } from 'firebase/database';\r\nimport { firebaseConfig } from '../src/firebase-config';\r\n\r\nconst app = initializeApp(firebaseConfig);\r\n\r\nconst database = getDatabase(app)\r\n\r\nexport default database;","export const firebaseConfig = {\r\n  apiKey: 'AIzaSyA2wyfn9RG1HL1hpY_5h0C0WoBegLBo7gI',\r\n  authDomain: 'couriersappdata.firebaseapp.com',\r\n  databaseURL:\r\n    'https://couriersappdata-default-rtdb.europe-west1.firebasedatabase.app',\r\n  projectId: 'couriersappdata',\r\n  storageBucket: 'couriersappdata.appspot.com',\r\n  messagingSenderId: '874912657772',\r\n  appId: '1:874912657772:web:8e43a5f410379595dc8349',\r\n  uuid: 'bd75dead-0023-4475-ae0d-1abe77f02c65',\r\n};\r\n\r\n","export default __webpack_public_path__ + \"static/media/courierIcon.c299fccf.png\";","export default __webpack_public_path__ + \"static/media/packageIcon.f9722f30.png\";","export const API_ENDPOINT = 'https://couriers-platform-backend.herokuapp.com';\r\nexport const SOCKET_ENDPOINT = 'wss://couriers-platform-backend-ws.herokuapp.com';\r\nexport const OSRM_URL = 'https://osrm.couriersplatform.pl/route/v1';","import { SOCKET_ENDPOINT } from \"./constants\";\r\n\r\nexport const ws = new WebSocket(`${SOCKET_ENDPOINT}`);","import React, { Component, useEffect, useState } from \"react\";\r\nimport { MapContainer, Marker, TileLayer, useMap, ZoomControl } from \"react-leaflet\";\r\n\r\nimport database from './database';\r\nimport { MapType } from \"./Models/MapType.enum\";\r\nimport { get, onChildChanged, ref } from \"firebase/database\";\r\nimport { Position } from \"./Models/position.model\";\r\nimport \"leaflet\";\r\nimport \"leaflet-routing-machine\";\r\nimport equal from \"fast-deep-equal\";\r\nimport courierIcon from './assets/courierIcon.png';\r\nimport packageIcon from './assets/packageIcon.png';\r\nimport { ws } from \"./websocket\";\r\nimport { API_ENDPOINT, OSRM_URL } from \"./constants\";\r\n\r\ndeclare let L: any;\r\n\r\ninterface IProps {\r\n    type: MapType;\r\n    id: string;\r\n    children?: JSX.Element[] | JSX.Element;\r\n    waypoints?: any[];\r\n    isLocal: boolean;\r\n    token: string;\r\n}\r\n\r\ninterface IMapProps {\r\n    type: MapType;\r\n    id: string;\r\n    children?: JSX.Element[] | JSX.Element;\r\n    waypoints?: any[];\r\n}\r\n\r\ninterface IState {\r\n    map: JSX.Element;\r\n}\r\n\r\nconst courierMarker = L.icon({\r\n    iconUrl: courierIcon,\r\n    iconRetinaUrl: courierIcon,\r\n    iconSize: [58, 58],\r\n    iconAnchor: [32, 58],\r\n    popupAnchor: null,\r\n    shadowUrl: null,\r\n    shadowSize: null,\r\n    shadowAnchor: null,\r\n    className: 'courierIcon'\r\n});\r\nconst packageIconMarker = L.icon({\r\n    iconUrl: packageIcon,\r\n    iconRetinaUrl: packageIcon,\r\n    iconSize: [58, 58],\r\n    iconAnchor: [32, 58],\r\n    popupAnchor: null,\r\n    shadowUrl: null,\r\n    shadowSize: null,\r\n    shadowAnchor: null,\r\n    className: 'packageIcon'\r\n});\r\n\r\nconst MapParentContainer = (props: IProps) => {\r\n    const [courierWaypoints, setCourierWaypoints] = useState<any[]>([]);\r\n    const [packageWaypoints, setPackageWaypoints] = useState<any[]>([]);\r\n    const [packageCourierId, setPackageCourierId] = useState<string>('');\r\n    const [wasHandshake, setWasHandshake] = useState<boolean>(false);\r\n\r\n    if (!wasHandshake && ws.readyState === ws.OPEN) {\r\n        ws.send(JSON.stringify({ id: props.id, type: props.type }));\r\n        setWasHandshake(true);\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!wasHandshake && ws.readyState === ws.OPEN) {\r\n            ws.send(JSON.stringify({ id: props.id, type: props.type }));\r\n            setWasHandshake(true);\r\n        }\r\n        if (props.type !== MapType.package) {\r\n            getWaypointsForCourier(props.id);\r\n        } else {\r\n            getWaypointsForPackage(props.id);\r\n        }\r\n    }, [props.type, props.id, wasHandshake]);\r\n\r\n    const getWaypointsForCourier = async (id: string) => {\r\n        if (props.isLocal) {\r\n            const courier = await (await get(ref(database, `couriers/${id}`))).val();\r\n            const positions: Position[] = [];\r\n            positions.push(courier.startPosition);\r\n            const currentPackage = await (await get(ref(database, `packages/${courier.currentPackages}`))).val();\r\n            positions.push(currentPackage.position);\r\n            await Promise.all(courier.undeliveredPackages.map(async (id: string) => {\r\n                positions.push(await (await get(ref(database, `packages/${id}`))).val().position);\r\n            }));\r\n            setCourierWaypoints(positions);\r\n        } else { //socket\r\n            const request = {\r\n                method: \"GET\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    'Authorization': props.token,\r\n                    'Accept': 'application/json',\r\n                },\r\n\r\n            };\r\n            const response = await fetch(`${API_ENDPOINT}/couriers/route/${id}`, request)\r\n                .then(response => response.json()\r\n                    .then(data => data));\r\n\r\n            setCourierWaypoints(response as unknown as Position[]);\r\n        }\r\n    }\r\n\r\n    const getWaypointsForPackage = async (id: string) => {\r\n        if (props.isLocal) {\r\n            const packageRoute: Position[] = [];\r\n            let courierId = '';\r\n            const packageModel = await (await get(ref(database, `packages/${id}`))).val();\r\n            const couriers = await (await get(ref(database, `couriers`))).val();\r\n            Object.keys(couriers).forEach((curId) => {\r\n                if (couriers[curId].currentPackages !== null && couriers[curId].currentPackages.id === id) {\r\n                    courierId = couriers[curId].employeeNumber;\r\n                    packageRoute.push(couriers[curId].startPosition);\r\n                }\r\n                if (couriers[curId].undeliveredPackages)\r\n                    couriers[curId].undeliveredPackages.forEach((p: string) => {\r\n                        if (p === id) {\r\n                            courierId = couriers[curId].employeeNumber;\r\n                            packageRoute.push(couriers[curId].startPosition);\r\n                        }\r\n                    });\r\n            });\r\n            packageRoute.push(packageModel.position);\r\n            setPackageCourierId(courierId);\r\n            setPackageWaypoints(packageRoute);\r\n        } else { //socket\r\n            const request = {\r\n                method: \"GET\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    'Authorization': props.token,\r\n                    'Accept': 'application/json'\r\n                }\r\n            };\r\n            const response = await fetch(`${API_ENDPOINT}/packages/route/${id}`, request)\r\n                .then(response => response.json()\r\n                    .then(data => data));\r\n\r\n            setPackageCourierId(response.courierId);\r\n            setPackageWaypoints(response.positions as unknown as Position[]);\r\n        }\r\n    }\r\n\r\n    if (props.type === MapType.courier) {\r\n        if (props.isLocal) {\r\n            const courierRef = ref(database, `couriers/${packageCourierId}`);\r\n            onChildChanged(courierRef, async (data) => {\r\n                if (data != null) {\r\n                    getWaypointsForCourier(props.id);\r\n                }\r\n            });\r\n        } else { //socket\r\n            ws.onmessage = ((message) => {\r\n                const data: { positions: Position[] } = JSON.parse(message.data);\r\n                setCourierWaypoints(data.positions);\r\n            });\r\n        }\r\n    }\r\n\r\n    if (props.type === MapType.navigation) {\r\n        if (props.isLocal) {\r\n            const courierRef = ref(database, `couriers/${packageCourierId}`);\r\n            onChildChanged(courierRef, async (data) => {\r\n                if (data != null) {\r\n                    getWaypointsForCourier(props.id);\r\n                }\r\n            });\r\n        } else {\r\n            ws.onmessage = ((message) => {\r\n                const data: { positions: Position[] } = JSON.parse(message.data);\r\n                setCourierWaypoints(data.positions);\r\n            });\r\n        }\r\n    }\r\n\r\n    if (props.type === MapType.package) {\r\n        if (props.isLocal) {\r\n            const courierRef = ref(database, `couriers/${props.id}`);\r\n\r\n            onChildChanged(courierRef, async (data) => {\r\n                if (data != null) {\r\n                    getWaypointsForPackage(props.id);\r\n                }\r\n            })\r\n        } else {\r\n            ws.onmessage = ((message) => {\r\n                const data: { positions: Position[] } = JSON.parse(message.data);\r\n                setPackageWaypoints(data.positions);\r\n            });\r\n        }\r\n    }\r\n\r\n    return <Map type={props.type} id={props.id}\r\n        waypoints={transformWaypoints(props.type === MapType.package ? packageWaypoints : courierWaypoints)} >\r\n        <TileLayer\r\n            //    attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n        />\r\n    </Map>\r\n}\r\n\r\nconst transformWaypoints = (positions: Position[]) => {\r\n    const waypoints: any[] = [];\r\n    if (positions) {\r\n        positions.forEach((p) => {\r\n            waypoints.push([p.latitude, p.longitude]);\r\n        });\r\n    }\r\n    return waypoints;\r\n}\r\n\r\nclass Map extends Component<IMapProps, IState> {\r\n    constructor(props: IMapProps) {\r\n        super(props);\r\n        this.state = {\r\n            map: this.getMap(),\r\n        }\r\n    }\r\n\r\n    getMap(): JSX.Element {\r\n        let center: [number, number] = [50, 20];\r\n        if (this.props.waypoints && this.props.waypoints.length === 1) {\r\n            center = [this.props.waypoints[0][0], this.props.waypoints[0][1]];\r\n        }\r\n        return <MapContainer\r\n            center={center}\r\n            zoom={13}\r\n            zoomControl={true}\r\n            id=\"mapId\">\r\n            {this.props.waypoints && this.props.waypoints.length !== 0 ? this.props.waypoints.map((wp, index) => {\r\n                if (index === 0)\r\n                    return <Marker key={Math.random()} position={wp} icon={courierMarker} />\r\n                else return <Marker key={Math.random()} position={wp} icon={packageIconMarker} />\r\n            }) : null}\r\n            <PackageRoute\r\n                type={this.props.type}\r\n                waypoints={this.props.waypoints ? this.props.waypoints : []}\r\n            />\r\n            <ZoomControl position=\"topleft\" />\r\n            {this.props.children ? this.props.children : null}\r\n        </MapContainer>\r\n    }\r\n\r\n    componentDidUpdate(prevProps: IProps) {\r\n        if (!equal(this.props, prevProps)) {\r\n            this.setState({\r\n                map: <div></div>,\r\n            });\r\n            this.setState({\r\n                map: this.getMap(),\r\n            });\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return this.state.map;\r\n    }\r\n}\r\n\r\nlet prevRoute: any = null;\r\n\r\nfunction PackageRoute({ waypoints, type }: { waypoints: any[], type: MapType }) {\r\n    const map = useMap();\r\n\r\n    const route = L.Routing.control({\r\n        waypoints: waypoints,\r\n        serviceUrl: OSRM_URL,\r\n        lineOptions: {\r\n            styles: [\r\n                {\r\n                    color: \"#287cfb\",\r\n                    opacity: 0.6,\r\n                    weight: 4,\r\n                },\r\n            ],\r\n        },\r\n        createMarker: function () { return null; },\r\n        fitSelectedRoutes: type === MapType.courier || type === MapType.package ? true : false,\r\n        showAlternatives: false,\r\n    });\r\n    if (prevRoute !== null) map.removeControl(prevRoute);\r\n    map.addControl(route);\r\n\r\n    if (type === MapType.navigation && waypoints.length >= 1) {\r\n        map.fitBounds([waypoints[0], waypoints[1]]);\r\n    }\r\n\r\n    prevRoute = route;\r\n    return null;\r\n}\r\n\r\nexport default MapParentContainer;\r\n","import React from 'react';\r\nimport './App.css';\r\nimport { MapType } from './Models/MapType.enum';\r\n\r\nimport MapParentContainer from './Map';\r\nimport { ws } from './websocket';\r\n\r\ninterface IProps { }\r\n\r\ninterface IState {\r\n  type: MapType,\r\n  id: string,\r\n  isLocalDev: boolean,\r\n  token: string\r\n}\r\n\r\nexport default class App extends React.Component<IProps, IState> {\r\n\r\n  constructor(props: IProps) {\r\n    super(props);\r\n\r\n    const url = new URL(window.location.href);\r\n    const type = MapType[url.searchParams.get(\"type\") as string as keyof typeof MapType];\r\n    if (!type) console.log('%cMissing Type parameter in url', 'color: red');\r\n    const id = url.searchParams.get('id') as string;\r\n    const isLocalDev = url.searchParams.get('isLocalDev') === 'true';\r\n    if (!isLocalDev) console.log('%cLocalDevSetToFalse', 'color: orange');\r\n    else console.log('%cLocalDevSetToTrue', 'color: orange');\r\n    if (!id) console.log('%cMissing id parameter in url', \"color: red\");\r\n    const token = url.searchParams.get('token') as string;\r\n\r\n    this.state = {\r\n      type: type ?? MapType.package,\r\n      id: id ?? '',\r\n      isLocalDev: isLocalDev,\r\n      token: token ?? '',\r\n    }\r\n  }\r\n\r\n  handleEvent = (id: string, type: string, isLocalDev: string, token: string) => {\r\n    this.setState({\r\n      type: MapType[type as keyof typeof MapType],\r\n      id: id,\r\n      isLocalDev: isLocalDev === 'true',\r\n      token: token\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    ws.onopen = () => {\r\n      console.log(\"%cWebSocket Client Connected\", 'color: green');\r\n    };\r\n    ws.onerror = (e) => {\r\n      const str = JSON.stringify(e, [\"message\", \"arguments\", \"type\", \"name\"]);\r\n      console.log('%cwebsocket error: ' + str, 'color: red');\r\n    }\r\n    window.addEventListener(\"flutterInAppWebViewPlatformReady\", (event) => {\r\n      (window as any).flutter_inappwebview.callHandler('navigationHandler', 'test')\r\n        .then((data: any) => {\r\n          this.handleEvent(data.id, data.type, data.isLocalDev, data.token);\r\n        });\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return this.state.token !== ''\r\n      ? (<div className=\"App\" style={{ width: '100vw', height: '100vh' }}>\r\n        <MapParentContainer type={this.state.type} id={this.state.id} isLocal={this.state.isLocalDev} token={this.state.token} />\r\n      </div>\r\n      )\r\n      : <div style={{ fontSize: '32px', color: 'red', fontWeight: 'bold' }}>Missing Authorization Token</div>\r\n  };\r\n}\r\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}