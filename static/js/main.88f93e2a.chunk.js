(this.webpackJsonpmap_view=this.webpackJsonpmap_view||[]).push([[0],{42:function(e,t,n){},43:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);var a,o=n(3),r=n.n(o),c=n(27),i=n.n(c),s=(n(42),n(1)),p=n(2),u=n(5),l=n(6);n(43);!function(e){e.package="package",e.courier="courier",e.navigation="navigation"}(a||(a={}));var d=n(8),h=n.n(d),f=n(13),b=n(9),v=n(55),g=n(51),j=n(52),y=n(53),O=n(54),m=n(33),k=n(7),w=Object(m.a)({apiKey:"AIzaSyA2wyfn9RG1HL1hpY_5h0C0WoBegLBo7gI",authDomain:"couriersappdata.firebaseapp.com",databaseURL:"https://couriersappdata-default-rtdb.europe-west1.firebasedatabase.app",projectId:"couriersappdata",storageBucket:"couriersappdata.appspot.com",messagingSenderId:"874912657772",appId:"1:874912657772:web:8e43a5f410379595dc8349",uuid:"bd75dead-0023-4475-ae0d-1abe77f02c65"}),x=Object(k.b)(w),S=(n(15),n(46),n(34)),P=n.n(S),A=n.p+"static/media/courierIcon.c299fccf.png",I=n.p+"static/media/packageIcon.f9722f30.png",C="https://couriers-platform-backend.herokuapp.com",M=new WebSocket("".concat("wss://couriers-platform-backend-ws.herokuapp.com")),N=n(11),z=L.icon({iconUrl:A,iconRetinaUrl:A,iconSize:[58,58],iconAnchor:[32,58],popupAnchor:null,shadowUrl:null,shadowSize:null,shadowAnchor:null,className:"courierIcon"}),E=L.icon({iconUrl:I,iconRetinaUrl:I,iconSize:[58,58],iconAnchor:[32,58],popupAnchor:null,shadowUrl:null,shadowSize:null,shadowAnchor:null,className:"packageIcon"}),D=function(e){var t=[];return e&&e.forEach((function(e){t.push([e.latitude,e.longitude])})),t},T=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={map:a.getMap()},a}return Object(p.a)(n,[{key:"getMap",value:function(){var e=[50,20];return this.props.waypoints&&1===this.props.waypoints.length&&(e=[this.props.waypoints[0][0],this.props.waypoints[0][1]]),Object(N.jsxs)(g.a,{center:e,zoom:13,zoomControl:!0,id:"mapId",children:[this.props.waypoints&&0!==this.props.waypoints.length?this.props.waypoints.map((function(e,t){return 0===t?Object(N.jsx)(j.a,{position:e,icon:z},Math.random()):Object(N.jsx)(j.a,{position:e,icon:E},Math.random())})):null,Object(N.jsx)(J,{type:this.props.type,waypoints:this.props.waypoints?this.props.waypoints:[]}),Object(N.jsx)(y.a,{position:"topleft"}),this.props.children?this.props.children:null]})}},{key:"componentDidUpdate",value:function(e){P()(this.props,e)||(this.setState({map:Object(N.jsx)("div",{})}),this.setState({map:this.getMap()}))}},{key:"render",value:function(){return this.state.map}}]),n}(o.Component),U=null;function J(e){var t=e.waypoints,n=e.type,o=Object(O.a)(),r=L.Routing.control({waypoints:t,serviceUrl:"https://osrm.couriersplatform.pl/route/v1",lineOptions:{styles:[{color:"#287cfb",opacity:.6,weight:4}]},createMarker:function(){return null},fitSelectedRoutes:n===a.courier||n===a.package,showAlternatives:!1});return null!==U&&o.removeControl(U),o.addControl(r),n===a.navigation&&t.length>=1&&o.fitBounds([t[0],t[1]]),U=r,null}var R=function(e){var t=Object(o.useState)([]),n=Object(b.a)(t,2),r=n[0],c=n[1],i=Object(o.useState)([]),s=Object(b.a)(i,2),p=s[0],u=s[1],l=Object(o.useState)(""),d=Object(b.a)(l,2),g=d[0],j=d[1],y=Object(o.useState)(!1),O=Object(b.a)(y,2),m=O[0],w=O[1];m||M.readyState!==M.OPEN||(M.send(JSON.stringify({id:e.id,type:e.type})),w(!0)),Object(o.useEffect)((function(){m||M.readyState!==M.OPEN||e.id&&(M.send(JSON.stringify({id:e.id,type:e.type})),w(!0)),e.type!==a.package?S(e.id):L(e.id)}),[e.type,e.id,m]);var S=function(){var t=Object(f.a)(h.a.mark((function t(n){var a,o,r,i,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isLocal){t.next=19;break}return t.next=3,Object(k.a)(Object(k.d)(x,"couriers/".concat(n)));case 3:return t.next=5,t.sent.val();case 5:return a=t.sent,(o=[]).push(a.startPosition),t.next=10,Object(k.a)(Object(k.d)(x,"packages/".concat(a.currentPackages)));case 10:return t.next=12,t.sent.val();case 12:return r=t.sent,o.push(r.position),t.next=16,Promise.all(a.undeliveredPackages.map(function(){var e=Object(f.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o,e.next=3,Object(k.a)(Object(k.d)(x,"packages/".concat(t)));case 3:return e.next=5,e.sent.val().position;case 5:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:c(o),t.next=28;break;case 19:if(i={method:"GET",headers:{"Content-Type":"application/json",Authorization:e.token,Accept:"application/json"}},!n){t.next=27;break}return t.next=23,fetch("".concat(C,"/couriers/route/").concat(n),i).then((function(e){return e.json().then((function(e){return e}))}));case 23:s=t.sent,c(s),t.next=28;break;case 27:console.log("%cMissing Id","color: red");case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),L=function(){var t=Object(f.a)(h.a.mark((function t(n){var a,o,r,c,i,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isLocal){t.next=19;break}return a=[],o="",t.next=5,Object(k.a)(Object(k.d)(x,"packages/".concat(n)));case 5:return t.next=7,t.sent.val();case 7:return r=t.sent,t.next=10,Object(k.a)(Object(k.d)(x,"couriers"));case 10:return t.next=12,t.sent.val();case 12:c=t.sent,Object.keys(c).forEach((function(e){null!==c[e].currentPackages&&c[e].currentPackages.id===n&&(o=c[e].employeeNumber,a.push(c[e].startPosition)),c[e].undeliveredPackages&&c[e].undeliveredPackages.forEach((function(t){t===n&&(o=c[e].employeeNumber,a.push(c[e].startPosition))}))})),a.push(r.position),j(o),u(a),t.next=29;break;case 19:if(i={method:"GET",headers:{"Content-Type":"application/json",Authorization:e.token,Accept:"application/json"}},!n){t.next=28;break}return t.next=23,fetch("".concat(C,"/packages/route/").concat(n),i).then((function(e){return e.json().then((function(e){return e}))}));case 23:s=t.sent,j(s.courierId),u(s.positions),t.next=29;break;case 28:console.log("%cMissing Id","color: red");case 29:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();if(e.type===a.courier)if(e.isLocal){var P=Object(k.d)(x,"couriers/".concat(g));Object(k.c)(P,function(){var t=Object(f.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null!=n&&S(e.id);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else M.onmessage=function(e){var t=JSON.parse(e.data);c(t.positions)};if(e.type===a.navigation)if(e.isLocal){var A=Object(k.d)(x,"couriers/".concat(g));Object(k.c)(A,function(){var t=Object(f.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null!=n&&S(e.id);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else M.onmessage=function(e){var t=JSON.parse(e.data);c(t.positions)};if(e.type===a.package)if(e.isLocal){var I=Object(k.d)(x,"couriers/".concat(e.id));Object(k.c)(I,function(){var t=Object(f.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null!=n&&L(e.id);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else M.onmessage=function(e){var t=JSON.parse(e.data);u(t.positions)};return Object(N.jsx)(T,{type:e.type,id:e.id,waypoints:D(e.type===a.package?p:r),children:Object(N.jsx)(v.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})})},B=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var o;Object(s.a)(this,n),(o=t.call(this,e)).handleEvent=function(e,t,n,r){o.setState({type:a[t],id:e,isLocalDev:"true"===n,token:r})};var r=new URL(window.location.href),c=a[r.searchParams.get("type")];c||console.log("%cMissing Type parameter in url","color: red");var i=r.searchParams.get("id"),p="true"===r.searchParams.get("isLocalDev");p?console.log("%cLocalDevSetToTrue","color: orange"):console.log("%cLocalDevSetToFalse","color: orange"),i||console.log("%cMissing id parameter in url","color: red");var u=r.searchParams.get("token");return o.state={type:null!==c&&void 0!==c?c:a.package,id:null!==i&&void 0!==i?i:"",isLocalDev:p,token:null!==u&&void 0!==u?u:""},o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;M.onopen=function(){console.log("%cWebSocket Client Connected","color: green")},M.onerror=function(e){var t=JSON.stringify(e,["message","arguments","type","name"]);console.log("%cwebsocket error: "+t,"color: red")},window.addEventListener("flutterInAppWebViewPlatformReady",(function(t){window.flutter_inappwebview.callHandler("navigationHandler","test").then((function(t){e.handleEvent(t.id,t.type,t.isLocalDev,t.token)}))}))}},{key:"render",value:function(){return""!==this.state.token?Object(N.jsx)("div",{className:"App",style:{width:"100vw",height:"100vh"},children:Object(N.jsx)(R,{type:this.state.type,id:this.state.id,isLocal:this.state.isLocalDev,token:this.state.token})}):Object(N.jsx)("div",{style:{fontSize:"32px",color:"red",fontWeight:"bold"},children:"Missing Authorization Token"})}}]),n}(r.a.Component),F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,56)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),o(e),r(e),c(e)}))};i.a.render(Object(N.jsx)(r.a.StrictMode,{children:Object(N.jsx)(B,{})}),document.getElementById("root")),F()}},[[49,1,2]]]);
//# sourceMappingURL=main.88f93e2a.chunk.js.map